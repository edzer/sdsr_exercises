<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>16&nbsp; Spatial Regression – Spatial Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./17.html" rel="next">
<link href="./15.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-f8cb7fe94b71c4ea6759b609738bfe9c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-GFR4ZDG7V6"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
 
  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'analytics_storage': 'denied'
  });
gtag('config', 'G-GFR4ZDG7V6', { 'anonymize_ip': true});
</script>
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./16.html"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Spatial Regression</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Spatial Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/edzer/sdsr_exercises/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial Data Science, with applications in R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Intro</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Coordinates</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Geometries</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Spherical geometry</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Attributes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Cubes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">sf, stars</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Plotting</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Large datasets</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Statistical models for spatial data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Spatial Point Patterns</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Spatial Interpolation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Multivariate and Spatiotemporal Geostatistics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Proximity and Areal Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Measures of spatial autocorrelation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Spatial Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Spatial econometrics models</span></span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#exercise-16.1" id="toc-exercise-16.1" class="nav-link active" data-scroll-target="#exercise-16.1">Exercise 16.1</a></li>
  <li><a href="#exercise-16.2" id="toc-exercise-16.2" class="nav-link" data-scroll-target="#exercise-16.2">Exercise 16.2</a></li>
  <li><a href="#exercise-16.3" id="toc-exercise-16.3" class="nav-link" data-scroll-target="#exercise-16.3">Exercise 16.3</a></li>
  <li><a href="#exercise-16.4" id="toc-exercise-16.4" class="nav-link" data-scroll-target="#exercise-16.4">Exercise 16.4</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/edzer/sdsr_exercises/edit/main/16.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Spatial Regression</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="exercise-16.1" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="exercise-16.1">Exercise 16.1</h2>
<p>The archived <strong>HSAR</strong> package includes an upper level polygon support municipality department data set, ans a lower level property data set. Both are <code>"sf"</code> objects, in the same projected CRS, provided locally.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="co"># Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.4.0; sf_use_s2() is TRUE</span></span>
<span><span class="co">#library(HSAR)</span></span>
<span><span class="co">#data(depmunic)</span></span>
<span><span class="co">#data(properties)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"spData"</span><span class="op">)</span> <span class="op">&gt;</span> <span class="st">"2.2.0"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">depmunic</span>, package<span class="op">=</span><span class="st">"spData"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">properties</span>, package<span class="op">=</span><span class="st">"spData"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op">(</span><span class="st">"data/PropertiesAthens.zip"</span>, files<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"depmunic.RData"</span>,</span>
<span>    <span class="st">"properties.RData"</span><span class="op">)</span>, exdir<span class="op">=</span><span class="st">"data"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/depmunic.RData"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/properties.RData"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">depmunic</span><span class="op">$</span><span class="va">popdens</span> <span class="op">&lt;-</span> <span class="va">depmunic</span><span class="op">$</span><span class="va">population</span><span class="op">/</span> <span class="op">(</span><span class="fl">10000</span><span class="op">*</span><span class="va">depmunic</span><span class="op">$</span><span class="va">area</span><span class="op">)</span></span>
<span><span class="va">depmunic</span><span class="op">$</span><span class="va">foreigners</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">depmunic</span><span class="op">$</span><span class="va">pop_rest</span><span class="op">/</span> <span class="va">depmunic</span><span class="op">$</span><span class="va">population</span></span>
<span><span class="va">depmunic</span><span class="op">$</span><span class="va">prgreensp</span> <span class="op">&lt;-</span> <span class="va">depmunic</span><span class="op">$</span><span class="va">greensp</span><span class="op">/</span> <span class="op">(</span><span class="fl">10000</span><span class="op">*</span><span class="va">depmunic</span><span class="op">$</span><span class="va">area</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The vignette <code>PropertiesAthens.Rmd</code> can be extracted from the <a href="https://cran.r-project.org/src/contrib/Archive/HSAR/HSAR_0.5.1.tar.gz">archived HSAR package</a>, and can be run and viewed (“Knit”) in rstudio by replacing on line 18 the command <code><a href="https://spatlyu.github.io/HSAR/">library(HSAR)</a></code> with <code><a href="https://Matrix.R-forge.R-project.org">library(Matrix)</a></code>.</p>
<p>In the vignette, two upper-level variables are added to the six already present, and we change the green space variable scaling to avoid numerical issues in calculating coefficient standard errors.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">depmunic</span><span class="op">)</span></span>
<span><span class="co">#     num_dep        airbnb          museums         population    </span></span>
<span><span class="co">#  Min.   :1.0   Min.   : 144.0   Min.   : 0.000   Min.   : 45168  </span></span>
<span><span class="co">#  1st Qu.:2.5   1st Qu.: 377.5   1st Qu.: 0.000   1st Qu.: 78753  </span></span>
<span><span class="co">#  Median :4.0   Median : 565.0   Median : 0.000   Median : 98283  </span></span>
<span><span class="co">#  Mean   :4.0   Mean   : 712.3   Mean   : 2.571   Mean   : 93702  </span></span>
<span><span class="co">#  3rd Qu.:5.5   3rd Qu.: 675.5   3rd Qu.: 0.500   3rd Qu.:112677  </span></span>
<span><span class="co">#  Max.   :7.0   Max.   :2171.0   Max.   :17.000   Max.   :129603  </span></span>
<span><span class="co">#     pop_rest        greensp            area                geometry</span></span>
<span><span class="co">#  Min.   : 2735   Min.   : 40656   Min.   :3.987   POLYGON      :7  </span></span>
<span><span class="co">#  1st Qu.: 4588   1st Qu.: 42340   1st Qu.:4.264   epsg:2100    :0  </span></span>
<span><span class="co">#  Median : 5099   Median : 93715   Median :4.836   +proj=tmer...:0  </span></span>
<span><span class="co">#  Mean   : 7109   Mean   :183796   Mean   :5.420                    </span></span>
<span><span class="co">#  3rd Qu.: 8110   3rd Qu.:294286   3rd Qu.:6.412                    </span></span>
<span><span class="co">#  Max.   :16531   Max.   :478951   Max.   :7.764                    </span></span>
<span><span class="co">#     popdens         foreigners       prgreensp     </span></span>
<span><span class="co">#  Min.   :0.8039   Min.   : 4.890   Min.   :0.7708  </span></span>
<span><span class="co">#  1st Qu.:1.2979   1st Qu.: 5.058   1st Qu.:0.9653  </span></span>
<span><span class="co">#  Median :1.8763   Median : 6.055   Median :1.2070  </span></span>
<span><span class="co">#  Mean   :1.8697   Mean   : 7.369   Mean   :3.3883  </span></span>
<span><span class="co">#  3rd Qu.:2.2807   3rd Qu.: 8.882   3rd Qu.:4.9527  </span></span>
<span><span class="co">#  Max.   :3.2508   Max.   :12.755   Max.   :9.9040</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The properties data set has only four variables, but with price per square metre already added:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">properties</span><span class="op">)</span></span>
<span><span class="co">#       id                 size             price        </span></span>
<span><span class="co">#  Length:1000        Min.   :  21.00   Min.   :   8000  </span></span>
<span><span class="co">#  Class :character   1st Qu.:  55.00   1st Qu.:  44750  </span></span>
<span><span class="co">#  Mode  :character   Median :  75.00   Median :  80000  </span></span>
<span><span class="co">#                     Mean   :  83.17   Mean   : 123677  </span></span>
<span><span class="co">#                     3rd Qu.:  98.00   3rd Qu.: 147000  </span></span>
<span><span class="co">#                     Max.   :1250.00   Max.   :5500000  </span></span>
<span><span class="co">#      prpsqm            age          dist_metro      </span></span>
<span><span class="co">#  Min.   : 207.5   Min.   : 0.00   Min.   :   4.423  </span></span>
<span><span class="co">#  1st Qu.: 631.1   1st Qu.:11.00   1st Qu.: 338.523  </span></span>
<span><span class="co">#  Median :1098.8   Median :42.00   Median : 537.250  </span></span>
<span><span class="co">#  Mean   :1316.9   Mean   :34.16   Mean   : 610.772  </span></span>
<span><span class="co">#  3rd Qu.:1814.2   3rd Qu.:48.00   3rd Qu.: 819.929  </span></span>
<span><span class="co">#  Max.   :9166.7   Max.   :67.00   Max.   :1888.856  </span></span>
<span><span class="co">#           geometry   </span></span>
<span><span class="co">#  POINT        :1000  </span></span>
<span><span class="co">#  epsg:2100    :   0  </span></span>
<span><span class="co">#  +proj=tmer...:   0  </span></span>
<span><span class="co">#                      </span></span>
<span><span class="co">#                      </span></span>
<span><span class="co"># </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The values of the variables in <code>depmunic</code> get copied to each of the properties falling within the boundaries of the municipality departments:</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">properties_in_dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html">st_join</a></span><span class="op">(</span><span class="va">properties</span>, <span class="va">depmunic</span>, join <span class="op">=</span> <span class="va">st_within</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="exercise-16.2" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="exercise-16.2">Exercise 16.2</h2>
<p>For polygon support, we prefer contiguous neighbours:</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">mun_nb</span> <span class="op">&lt;-</span> <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">depmunic</span>, row.names<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">depmunic</span><span class="op">$</span><span class="va">num_dep</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Neighbour list object:</span></span>
<span><span class="co"># Number of regions: 7 </span></span>
<span><span class="co"># Number of nonzero links: 20 </span></span>
<span><span class="co"># Percentage nonzero weights: 40.81633 </span></span>
<span><span class="co"># Average number of links: 2.857143</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Global spatial autocorrelation is marginally detected for the green space variable:</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.test.html">moran.test</a></span><span class="op">(</span><span class="va">depmunic</span><span class="op">$</span><span class="va">prgreensp</span>, <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">mun_nb</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   Moran I test under randomisation</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># data:  depmunic$prgreensp  </span></span>
<span><span class="co"># weights: spdep::nb2listw(mun_nb)    </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Moran I statistic standard deviate = 1.825, p-value = 0.034</span></span>
<span><span class="co"># alternative hypothesis: greater</span></span>
<span><span class="co"># sample estimates:</span></span>
<span><span class="co"># Moran I statistic       Expectation          Variance </span></span>
<span><span class="co">#        0.22384238       -0.16666667        0.04578844</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Unlike the vignette, which uses distance neighbours up to 1300 m and creates a very dense representation, we choose <code>k=4</code> k-nearest neighbours, then convert to symmetry (note that some point locations are duplicated, preventing the use of spatial indexing):</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">pr_nb_k4s</span> <span class="op">&lt;-</span> <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knn2nb.html">knn2nb</a></span><span class="op">(</span><span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knearneigh.html">knearneigh</a></span><span class="op">(</span><span class="va">properties</span>, k<span class="op">=</span><span class="fl">4</span><span class="op">)</span>, sym<span class="op">=</span><span class="cn">TRUE</span>, row.names<span class="op">=</span><span class="va">properties</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Warning in spdep::knearneigh(properties, k = 4): knearneigh:</span></span>
<span><span class="co"># identical points found</span></span>
<span><span class="co"># Warning in spdep::knearneigh(properties, k = 4): knearneigh:</span></span>
<span><span class="co"># kd_tree not available for identical points</span></span>
<span><span class="co"># Warning in spdep::knn2nb(spdep::knearneigh(properties, k = 4), sym</span></span>
<span><span class="co"># = TRUE, : neighbour object has 5 sub-graphs</span></span>
<span><span class="co"># Neighbour list object:</span></span>
<span><span class="co"># Number of regions: 1000 </span></span>
<span><span class="co"># Number of nonzero links: 5874 </span></span>
<span><span class="co"># Percentage nonzero weights: 0.5874 </span></span>
<span><span class="co"># Average number of links: 5.874 </span></span>
<span><span class="co"># 5 disjoint connected subgraphs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Copying out has led to the introduction of very powerful positive spatial autocorrelation in this and other variables copied out:</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.test.html">moran.test</a></span><span class="op">(</span><span class="va">properties_in_dd</span><span class="op">$</span><span class="va">prgreensp</span>, <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">pr_nb_k4s</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   Moran I test under randomisation</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># data:  properties_in_dd$prgreensp  </span></span>
<span><span class="co"># weights: spdep::nb2listw(pr_nb_k4s)    </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Moran I statistic standard deviate = 51.666, p-value &lt;</span></span>
<span><span class="co"># 2.2e-16</span></span>
<span><span class="co"># alternative hypothesis: greater</span></span>
<span><span class="co"># sample estimates:</span></span>
<span><span class="co"># Moran I statistic       Expectation          Variance </span></span>
<span><span class="co">#      0.9757099996     -0.0010010010      0.0003573715</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="exercise-16.3" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="exercise-16.3">Exercise 16.3</h2>
<p>The vignette proposes the full property level and municipal department level set of variables straight away. Here we choose the property level ones first, and update for the copied out municipal department level ones next:</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">f_pr</span> <span class="op">&lt;-</span> <span class="va">prpsqm</span> <span class="op">~</span> <span class="va">size</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">dist_metro</span></span>
<span><span class="va">f_pr_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">f_pr</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="va">foreigners</span> <span class="op">+</span> <span class="va">prgreensp</span> <span class="op">+</span> <span class="va">popdens</span> <span class="op">+</span> <span class="va">museums</span> <span class="op">+</span> <span class="va">airbnb</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Adding in the copied out upper level variables appears to account for more of the variability of the response than leaving them out:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span>
<span><span class="co"># Loading required package: nlme</span></span>
<span><span class="co"># This is mgcv 1.9-3. For overview type 'help("mgcv-package")'.</span></span>
<span><span class="va">pr_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">f_pr</span>, data<span class="op">=</span><span class="va">properties_in_dd</span><span class="op">)</span></span>
<span><span class="va">pr_2lev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">f_pr_md</span>, data<span class="op">=</span><span class="va">properties_in_dd</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">pr_base</span>, <span class="va">pr_2lev</span>, test<span class="op">=</span><span class="st">"Chisq"</span><span class="op">)</span></span>
<span><span class="co"># Analysis of Deviance Table</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Model 1: prpsqm ~ size + age + dist_metro</span></span>
<span><span class="co"># Model 2: prpsqm ~ size + age + dist_metro + foreigners + prgreensp + popdens + </span></span>
<span><span class="co">#     museums + airbnb</span></span>
<span><span class="co">#   Resid. Df Resid. Dev Df  Deviance  Pr(&gt;Chi)    </span></span>
<span><span class="co"># 1       996  625149227                           </span></span>
<span><span class="co"># 2       991  524571512  5 100577716 &lt; 2.2e-16 ***</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pr_base</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Family: gaussian </span></span>
<span><span class="co"># Link function: identity </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Formula:</span></span>
<span><span class="co"># prpsqm ~ size + age + dist_metro</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Parametric coefficients:</span></span>
<span><span class="co">#               Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co"># (Intercept) 1702.61693   78.59752   21.66  &lt; 2e-16 ***</span></span>
<span><span class="co"># size           5.18681    0.46510   11.15  &lt; 2e-16 ***</span></span>
<span><span class="co"># age          -18.11938    1.33737  -13.55  &lt; 2e-16 ***</span></span>
<span><span class="co"># dist_metro    -0.32446    0.07115   -4.56 5.75e-06 ***</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># R-sq.(adj) =  0.234   Deviance explained = 23.7%</span></span>
<span><span class="co"># GCV = 6.3018e+05  Scale est. = 6.2766e+05  n = 1000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pr_2lev</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Family: gaussian </span></span>
<span><span class="co"># Link function: identity </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Formula:</span></span>
<span><span class="co"># prpsqm ~ size + age + dist_metro + foreigners + prgreensp + popdens + </span></span>
<span><span class="co">#     museums + airbnb</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Parametric coefficients:</span></span>
<span><span class="co">#               Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co"># (Intercept) 1648.17176  189.84951   8.681   &lt;2e-16 ***</span></span>
<span><span class="co"># size           4.29551    0.43386   9.901   &lt;2e-16 ***</span></span>
<span><span class="co"># age          -20.18585    1.27009 -15.893   &lt;2e-16 ***</span></span>
<span><span class="co"># dist_metro    -0.15180    0.07159  -2.120   0.0342 *  </span></span>
<span><span class="co"># foreigners   -38.13473   22.54311  -1.692   0.0910 .  </span></span>
<span><span class="co"># prgreensp     23.90080   16.33291   1.463   0.1437    </span></span>
<span><span class="co"># popdens      -51.82590  103.65578  -0.500   0.6172    </span></span>
<span><span class="co"># museums      -19.06125   21.27904  -0.896   0.3706    </span></span>
<span><span class="co"># airbnb         0.63284    0.32887   1.924   0.0546 .  </span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># R-sq.(adj) =  0.354   Deviance explained =   36%</span></span>
<span><span class="co"># GCV = 5.3414e+05  Scale est. = 5.2934e+05  n = 1000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Adding an upper level IID random effect to the base formula also improves the fit of the model substantially:</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pr_base_iid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">f_pr</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">num_dep</span>, bs<span class="op">=</span><span class="st">"re"</span><span class="op">)</span><span class="op">)</span>, data<span class="op">=</span><span class="va">properties_in_dd</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">pr_base</span>, <span class="va">pr_base_iid</span>, test<span class="op">=</span><span class="st">"Chisq"</span><span class="op">)</span></span>
<span><span class="co"># Analysis of Deviance Table</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Model 1: prpsqm ~ size + age + dist_metro</span></span>
<span><span class="co"># Model 2: prpsqm ~ size + age + dist_metro + s(num_dep, bs = "re")</span></span>
<span><span class="co">#   Resid. Df Resid. Dev      Df Deviance  Pr(&gt;Chi)    </span></span>
<span><span class="co"># 1       996  625149227                               </span></span>
<span><span class="co"># 2       995  557913777 0.99993 67235450 &lt; 2.2e-16 ***</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pr_base_iid</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Family: gaussian </span></span>
<span><span class="co"># Link function: identity </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Formula:</span></span>
<span><span class="co"># prpsqm ~ size + age + dist_metro + s(num_dep, bs = "re")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Parametric coefficients:</span></span>
<span><span class="co">#               Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co"># (Intercept) 2244.07579   89.35422  25.114  &lt; 2e-16 ***</span></span>
<span><span class="co"># size           4.63594    0.44249  10.477  &lt; 2e-16 ***</span></span>
<span><span class="co"># age          -19.12405    1.26739 -15.089  &lt; 2e-16 ***</span></span>
<span><span class="co"># dist_metro    -0.18383    0.06848  -2.685  0.00738 ** </span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Approximate significance of smooth terms:</span></span>
<span><span class="co">#               edf Ref.df     F p-value    </span></span>
<span><span class="co"># s(num_dep) 0.9916      1 118.9  &lt;2e-16 ***</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># R-sq.(adj) =  0.316   Deviance explained = 31.9%</span></span>
<span><span class="co"># GCV = 5.6353e+05  Scale est. = 5.6071e+05  n = 1000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This improvement is much more moderate when both the upper level variables and IID random effect are present:</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pr_2lev_iid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">f_pr_md</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">num_dep</span>, bs<span class="op">=</span><span class="st">"re"</span><span class="op">)</span><span class="op">)</span>, data<span class="op">=</span><span class="va">properties_in_dd</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">pr_2lev</span>, <span class="va">pr_2lev_iid</span>, test<span class="op">=</span><span class="st">"Chisq"</span><span class="op">)</span></span>
<span><span class="co"># Analysis of Deviance Table</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Model 1: prpsqm ~ size + age + dist_metro + foreigners + prgreensp + popdens + </span></span>
<span><span class="co">#     museums + airbnb</span></span>
<span><span class="co"># Model 2: prpsqm ~ size + age + dist_metro + foreigners + prgreensp + popdens + </span></span>
<span><span class="co">#     museums + airbnb + s(num_dep, bs = "re")</span></span>
<span><span class="co">#   Resid. Df Resid. Dev      Df Deviance Pr(&gt;Chi)  </span></span>
<span><span class="co"># 1    991.00  524571512                            </span></span>
<span><span class="co"># 2    990.04  522144057 0.95676  2427454  0.02981 *</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pr_2lev_iid</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Family: gaussian </span></span>
<span><span class="co"># Link function: identity </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Formula:</span></span>
<span><span class="co"># prpsqm ~ size + age + dist_metro + foreigners + prgreensp + popdens + </span></span>
<span><span class="co">#     museums + airbnb + s(num_dep, bs = "re")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Parametric coefficients:</span></span>
<span><span class="co">#               Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co"># (Intercept) 1520.74633  200.41291   7.588 7.48e-14 ***</span></span>
<span><span class="co"># size           4.29515    0.43303   9.919  &lt; 2e-16 ***</span></span>
<span><span class="co"># age          -20.09458    1.26851 -15.841  &lt; 2e-16 ***</span></span>
<span><span class="co"># dist_metro    -0.14574    0.07152  -2.038  0.04184 *  </span></span>
<span><span class="co"># foreigners   -83.04410   32.17854  -2.581  0.01000 *  </span></span>
<span><span class="co"># prgreensp    -68.29107   49.95934  -1.367  0.17196    </span></span>
<span><span class="co"># popdens      261.72640  191.05195   1.370  0.17102    </span></span>
<span><span class="co"># museums     -125.97470   58.73993  -2.145  0.03223 *  </span></span>
<span><span class="co"># airbnb         1.92092    0.73695   2.607  0.00928 ** </span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Approximate significance of smooth terms:</span></span>
<span><span class="co">#               edf Ref.df     F p-value  </span></span>
<span><span class="co"># s(num_dep) 0.7921      1 3.811  0.0285 *</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># R-sq.(adj) =  0.357   Deviance explained = 36.3%</span></span>
<span><span class="co"># GCV = 5.3252e+05  Scale est. = 5.2731e+05  n = 1000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="exercise-16.4" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="exercise-16.4">Exercise 16.4</h2>
<p>The <code>"mrf"</code> smooth term needs ID keys set so that the neighbour object is correctly matched to the observations. Once these are provided, the properties level model with a municipality department level MRF smooth may be fit:</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">mun_nb</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">mun_nb</span>, <span class="st">"region.id"</span><span class="op">)</span></span>
<span><span class="va">properties_in_dd</span><span class="op">$</span><span class="va">num_dep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">properties_in_dd</span><span class="op">$</span><span class="va">num_dep</span><span class="op">)</span></span>
<span><span class="va">pr_base_mrf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">f_pr</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">num_dep</span>, bs<span class="op">=</span><span class="st">"mrf"</span>, xt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>nb<span class="op">=</span><span class="va">mun_nb</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    data<span class="op">=</span><span class="va">properties_in_dd</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pr_base_mrf</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Family: gaussian </span></span>
<span><span class="co"># Link function: identity </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Formula:</span></span>
<span><span class="co"># prpsqm ~ size + age + dist_metro + s(num_dep, bs = "mrf", xt = list(nb = mun_nb))</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Parametric coefficients:</span></span>
<span><span class="co">#               Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co"># (Intercept) 1730.81146   76.44218  22.642   &lt;2e-16 ***</span></span>
<span><span class="co"># size           4.32010    0.43280   9.982   &lt;2e-16 ***</span></span>
<span><span class="co"># age          -20.00432    1.26761 -15.781   &lt;2e-16 ***</span></span>
<span><span class="co"># dist_metro    -0.14718    0.07142  -2.061   0.0396 *  </span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Approximate significance of smooth terms:</span></span>
<span><span class="co">#              edf Ref.df    F p-value    </span></span>
<span><span class="co"># s(num_dep) 5.852      6 31.9  &lt;2e-16 ***</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># R-sq.(adj) =  0.357   Deviance explained = 36.3%</span></span>
<span><span class="co"># GCV = 5.3255e+05  Scale est. = 5.2731e+05  n = 1000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Repeating for the extended model with upper level variables present, we see that no more response variability is accounted for than in the lower level variables only MRF RE model, and none of the upper level variables are significant at conventional levels.</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pr_2lev_mrf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">f_pr_md</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">num_dep</span>, bs<span class="op">=</span><span class="st">"mrf"</span>, xt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>nb<span class="op">=</span><span class="va">mun_nb</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    data<span class="op">=</span><span class="va">properties_in_dd</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pr_2lev_mrf</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Family: gaussian </span></span>
<span><span class="co"># Link function: identity </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Formula:</span></span>
<span><span class="co"># prpsqm ~ size + age + dist_metro + foreigners + prgreensp + popdens + </span></span>
<span><span class="co">#     museums + airbnb + s(num_dep, bs = "mrf", xt = list(nb = mun_nb))</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Parametric coefficients:</span></span>
<span><span class="co">#               Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co"># (Intercept) 1510.58909  425.16218   3.553 0.000399 ***</span></span>
<span><span class="co"># size           4.29515    0.43303   9.919  &lt; 2e-16 ***</span></span>
<span><span class="co"># age          -20.09456    1.26851 -15.841  &lt; 2e-16 ***</span></span>
<span><span class="co"># dist_metro    -0.14574    0.07152  -2.038 0.041844 *  </span></span>
<span><span class="co"># foreigners   -42.18041   58.30966  -0.723 0.469613    </span></span>
<span><span class="co"># prgreensp     15.34415   54.84749   0.280 0.779720    </span></span>
<span><span class="co"># popdens      -50.09688  259.59932  -0.193 0.847016    </span></span>
<span><span class="co"># museums      -53.40432   55.25567  -0.966 0.334033    </span></span>
<span><span class="co"># airbnb         1.01045    0.81453   1.241 0.215072    </span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Approximate significance of smooth terms:</span></span>
<span><span class="co">#               edf Ref.df     F p-value  </span></span>
<span><span class="co"># s(num_dep) 0.7922      1 3.812  0.0285 *</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># R-sq.(adj) =  0.357   Deviance explained = 36.3%</span></span>
<span><span class="co"># GCV = 5.3252e+05  Scale est. = 5.2731e+05  n = 1000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It also seems that the model without upper level variables outperforms that with them included:</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">pr_base_mrf</span>, <span class="va">pr_2lev_mrf</span>, test<span class="op">=</span><span class="st">"Chisq"</span><span class="op">)</span></span>
<span><span class="co"># Analysis of Deviance Table</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Model 1: prpsqm ~ size + age + dist_metro + s(num_dep, bs = "mrf", xt = list(nb = mun_nb))</span></span>
<span><span class="co"># Model 2: prpsqm ~ size + age + dist_metro + foreigners + prgreensp + popdens + </span></span>
<span><span class="co">#     museums + airbnb + s(num_dep, bs = "mrf", xt = list(nb = mun_nb))</span></span>
<span><span class="co">#   Resid. Df Resid. Dev        Df Deviance Pr(&gt;Chi)  </span></span>
<span><span class="co"># 1    990.01  522113016                              </span></span>
<span><span class="co"># 2    990.04  522143950 -0.037064   -30934    0.054 .</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and the MRF RE outperforms the IID RE:</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">pr_base_mrf</span>, <span class="va">pr_base_iid</span>, test<span class="op">=</span><span class="st">"Chisq"</span><span class="op">)</span></span>
<span><span class="co"># Analysis of Deviance Table</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Model 1: prpsqm ~ size + age + dist_metro + s(num_dep, bs = "mrf", xt = list(nb = mun_nb))</span></span>
<span><span class="co"># Model 2: prpsqm ~ size + age + dist_metro + s(num_dep, bs = "re")</span></span>
<span><span class="co">#   Resid. Df Resid. Dev      Df  Deviance  Pr(&gt;Chi)    </span></span>
<span><span class="co"># 1    990.01  522113016                                </span></span>
<span><span class="co"># 2    995.00  557913777 -4.9939 -35800762 2.786e-13 ***</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span>, file <span class="op">=</span> <span class="st">"data/ch16.RData"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/edzer\.github\.io\/sdsr_exercises\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./15.html" class="pagination-link" aria-label="Measures of spatial autocorrelation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Measures of spatial autocorrelation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./17.html" class="pagination-link" aria-label="Spatial econometrics models">
        <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Spatial econometrics models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/edzer/sdsr_exercises/edit/main/16.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer></body></html>